<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rix">
<title>z - Advanced topic: Rolling out your own binary cache • rix</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="z - Advanced topic: Rolling out your own binary cache">
<meta property="og:description" content="rix">
<meta property="og:image" content="https://b-rodrigues.github.io/rix/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rix</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/a-getting-started.html">a - Getting started</a>
    <a class="dropdown-item" href="../articles/b1-setting-up-and-using-rix-on-linux-and-windows.html">b1 - Setting up and using rix on Linux and Windows</a>
    <a class="dropdown-item" href="../articles/b2-setting-up-and-using-rix-on-macos.html">b2 - Setting up and using rix on macOS</a>
    <a class="dropdown-item" href="../articles/c-using-rix-to-build-project-specific-environments.html">c - Using rix to build project specific environments</a>
    <a class="dropdown-item" href="../articles/d1-installing-r-packages-in-a-nix-environment.html">d1 - Installing R packages in a Nix environment</a>
    <a class="dropdown-item" href="../articles/d2-installing-system-tools-and-texlive-packages-in-a-nix-environment.html">d2 - Installing system tools and TexLive packages in a Nix environment</a>
    <a class="dropdown-item" href="../articles/e-interactive-use.html">e - Interactive use</a>
    <a class="dropdown-item" href="../articles/z-advanced-topic-building-an-environment-for-literate-programming.html">z - Advanced topic: Building an environment for literate programming</a>
    <a class="dropdown-item" href="../articles/z-advanced-topic-handling-packages-with-remote-dependencies.html">z - Advanced topic: Handling packages with remote dependencies</a>
    <a class="dropdown-item" href="../articles/z-advanced-topic-reproducible-analytical-pipelines-with-nix.html">z - Advanced topic: Reproducible Analytical Pipelines with Nix</a>
    <a class="dropdown-item" href="../articles/z-advanced-topic-running-r-or-shell-code-in-nix-from-r.html">z - Advanced topic: Running R or Shell Code in Nix from R</a>
    <a class="dropdown-item" href="../articles/z-advanced-topic-using-nix-inside-docker.html">z - Advanced topic: Using Nix inside Docker</a>
    <a class="dropdown-item" href="../articles/z-binary_cache.html">z - Advanced topic: Rolling out your own binary cache</a>
    <a class="dropdown-item" href="../articles/z-bleeding_edge.html">z - Advanced topic: Understanding the rPackages set release cycle and using bleeding edge packages</a>
    <a class="dropdown-item" href="../articles/z-contributing_to_nixpkgs.html">z - Advanced topic: Contributing to nixpkgs</a>
    <a class="dropdown-item" href="../articles/z-developers-vignette-generate-an-environment-with-rix-only.html">z - Developers Vignette: Generate an environment with rix only</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/b-rodrigues/rix/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>z - Advanced topic: Rolling out your own binary cache</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/b-rodrigues/rix/blob/HEAD/vignettes/z-binary_cache.Rmd" class="external-link"><code>vignettes/z-binary_cache.Rmd</code></a></small>
      <div class="d-none name"><code>z-binary_cache.Rmd</code></div>
    </div>

    
    
<p><em>We recommend you first read
<code><a href="../articles/z-bleeding_edge.html">vignette("z-bleeding_edge")</a></code> before this one.</em></p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>At its core, the Nix package manager installs software from source,
which can take a very long time. For example, installing R or RStudio
from source could take up several hours, depending on your hardware.
Some R packages also must be compiled, so depending on the environment
you need, this could take several hours to build. In practice however,
this is rarely the case as most, if not all packages get pre-built and
made available through NixOS’s <a href="https://cache.nixos.org/" class="external-link">public
cache</a>. The Nix package manager first checks if what you need is in
the public cache, and if yes, it downloads a binary from there instead
of building it on your computer. This means that building an environment
is just a matter of waiting for packages to download.</p>
<p>However, in some cases, you might need to use packages that have not
been pre-built and cached yet, for example if you use
<code>rix(r_ver = "bleeding_edge")</code> or rix(r_ver = “frozen_edge”)`
to generate environments with bleeding edge packages. Building these
environments could potentially take quite long, because these packages
need to be built from source on your computer.</p>
<p>This vignette will explain how you can cut down on building times by
building the environment once, and then cache it, so you don’t need to
rebuild it on new machines. But before rolling out your own cache, try
using ours as explained in <code><a href="../articles/z-bleeding_edge.html">vignette("z-bleeding_edge")</a></code>, and
if our cache didn’t cover your needs, set up your own. This vignette
explains how.</p>
</div>
<div class="section level2">
<h2 id="using-github-actions-to-build-the-environment">Using Github Actions to build the environment<a class="anchor" aria-label="anchor" href="#using-github-actions-to-build-the-environment"></a>
</h2>
<p>Before creating a cache to hold the binaries for your development
environment, you first need to build the environment once. You can build
the environment on your computer, or on Github Actions. The advantage of
using Github Actions is that you can automate the process of building
and pushing the binaries each time you change the definition of the
environment.</p>
<p>For example, imagine you have the following
<code>generate_env.R</code> file for a project, which you version on
Github:</p>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://b-rodrigues.github.io/rix/">rix</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/rix.html">rix</a></span><span class="op">(</span>r_ver <span class="op">=</span> <span class="st">"bleeding_edge"</span>,</span>
<span>    r_pkgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dplyr"</span>, <span class="st">"ggplot2"</span><span class="op">)</span>,</span>
<span>    system_pkgs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    git_pkgs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    tex_pkgs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    ide <span class="op">=</span> <span class="st">"rstudio"</span>,</span>
<span>    project_path <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span></code></pre>
<p>if you add a packages to it, or re-run it, you’ll end up with a new
<code>default.nix</code> file, and so you will need to rebuild the
environment. Again, depending on the packages you include, this could
take quite some time to build. To generate a Github Actions workflow
file that will build the environment on Github Actions, run
<code>rix::ga_cachix(cache_name = "", path = "")</code> where
<code>cache_name</code> is the name of the cache you made on Cachix, and
<code>path</code> is the path to the <code>default.nix</code> file
generated by <code>generate_env.R</code>. By default, the environment
gets rebuilt every time you push changes to the <code>master/main</code>
branch of your repository, but you can also re-build the environment
periodically, by changing these lines:</p>
<pre><code>on:
  push:
    branches: [ master, main ]</code></pre>
<p>to these:</p>
<pre><code>on:
  push:
    branches: [ master, main ]
  schedule:
    - cron: '30 0 * * *'</code></pre>
<p>By using <a href="https://en.wikipedia.org/wiki/Cron#Overview" class="external-link">cron
syntax</a> you can specify how often you want the environment to be
re-built. This can be useful if you need to develop against the current
state of CRAN every day (for instance, for package development).</p>
</div>
<div class="section level2">
<h2 id="using-your-cache">Using your cache<a class="anchor" aria-label="anchor" href="#using-your-cache"></a>
</h2>
<p>Whether you decide to build the packages on Github or locally, to
then use your cache, you need to open an account on <a href="https://www.cachix.org/" class="external-link">Cachix</a>. The free tier includes 5GB of
space, which is more than enough for several development environments.
Once your account is done, create a personal auth token so that the
Github Actions workflow (or your computer, if building locally) can
authenticate to your Cachix account. Then, copy this token, and go to
your Github repository’s settings, then <em>Secrets and variables &gt;
Actions</em> and add a new repository secret. Copy the token in the
<code>Secret</code> field and name the secret <code>CACHIX_AUTH</code>.
Now the action can authenticate to Cachix and push the binaries it
builds! If building locally, simply run
<code>cachix authtoken &lt;TOKEN&gt;</code> in your terminal before
building (follow the instructions on Cachix website to learn how to push
the binaries afterwards).</p>
<p>To use your personalized cache on your computers, run the following
commands on your computer. First, install the Cachix client:</p>
<pre><code>nix-env -iA cachix -f https://cachix.org/api/v1/install</code></pre>
<p>then use the cache:</p>
<pre><code>cachix use your-cache-name</code></pre>
<p>Anyone can pull binaries from your cache, so if you work in a team,
you can ensure everyone can benefit from it. You can also use several
caches at once, NixOS’s public cache, our <code>rstats-on-nix</code>
cache, and your own, so your cache will only end up holding the binaries
not found in the other two caches!</p>
<p>Take a look at <a href="https://github.com/b-rodrigues/rix/blob/master/.github/workflows/cachix_dev_env.yml" class="external-link">this
package’s</a> repository for an example of how this is done in
practice.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bruno Rodrigues, Philipp Baumann.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
